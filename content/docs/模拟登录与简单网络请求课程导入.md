---
title: '模拟登录与简单网络请求课程导入'
---

## 概述

Pure课程表可以通过类似于爬虫的方式，在本地客户端获取课程信息，用户在APP内通过内置的界面可以直接获取到课程  
其优点在于嵌入较为完美，而缺点是教务系统改动对其影响较大  
  
所用到的课程提供器为（二选一）：

* NetworkCourseProvider
* LoginCourseProvider（继承自NetworkCourseProvider）

所用到的课程解析器为（对于以上两种提供器都可以对应使用）：

* NetworkCourseParser

## 适配

在content.adapters的对应文件夹下新建以下类的继承类，并实现具体方法

### NetworkCourseProvider/LoginCourseProvider

必须实现的方法有：

``` kotlin
// 将在加载课程网页时调用
// 参数：导入选项
// 返回：课程网页HTML
fun onLoadCoursesHtml(importOption: Int): String

// 以下为LoginCourseProvider独有

// 是否启用验证码
val enableCaptcha: Boolean

// 将在首次加载页面时调用，用于初始化页面信息，如验证码或者接下来POST登录需要的参数等
// 参数：导入选项
// 若没有任何需要返回的数据，可以使用LoginPageInfo.Empty
fun onLoadLoginPage(importOption: Int): LoginPageInfo

// 将在请求登录时调用
// 参数：用户ID，用户密码，验证码，登录页面信息，导入选项
// 登录失败等情况直接抛出错误即可
fun onLogin(userId: String, userPw: String, captchaCode: String?, loginPageInfo: LoginPageInfo, importOption: Int)
```

相关：[LoginPageInfo 登录页面信息]({{< ref "部分参数的数据结构#登录页面信息-LoginPageInfo" >}})  

可选实现的方法有：

``` kotlin
// 载入在线的导入选项
// 在Config中也存在静态导入选项参数时，优先考虑该函数返回的值
// 返回：导入选项字符串列表
fun onLoadImportOptions(): Array<String>?

// 自定义HTTP客户端构造方式
fun onPrepareClient(): HttpClient

// 将在加载课表时间时调用
// 若在线解析则需要重写
// 参数：导入选项
// 返回：课表时间HTML
fun onLoadScheduleTimesHtml(importOption: Int): String?

// 将在加载学期时调用
// 若在线解析则需要重写
// 参数：导入选项
// 返回：学期HTML
fun onLoadTermHtml(importOption: Int): String?

// 将在清理连接时调用，即每次课程导入结束后
// 一般用于注销登录
fun onClearConnection()

// 以下为LoginCourseProvider独有

// 将在下载验证码时调用
// 无特殊情况一般不需要重写该方法
// 参数：验证码URL，导入选项
// 返回：验证码Bitmap
fun onDownloadCaptchaImage(captchaUrl: String, importOption: Int): Bitmap?
```

可用方法有：

``` kotlin
// 课程提供器参数
val params

// 课程提供器参数(强制非空)
fun requireParams()

// HTTP客户端
val httpClient: HttpClient
```

### NetworkCourseParser

必须实现的方法有：

``` kotlin
// 将在解析课表时间时调用
// 若没有在Provider中重写onLoadScheduleTimesHtml，content参数默认为null
// 参数：导入参数，待解析的HTML
// 返回：课表时间列表
fun onParseScheduleTimes(importOption: Int, content: String?): List<ScheduleTime>

// 将在解析课程时调用
// 参数：导入参数，待解析的HTML
// 返回：课程解析结果
fun onParseCourses(importOption: Int, content: String?): CourseParseResult

// 将在解析学期时调用
// 参数：导入参数，待解析的HTML
// 返回：Pair<学期开始时间 学期结束时间>
fun onParseTerm(importOption: Int, content: String?): Pair<Date, Date>?
```

相关：  
[CourseParseResult 课程解析结果]({{< ref "课程解析工具方法#CourseParseResult" >}})  
[课程相关的数据结构]({{< ref "课程相关的数据结构" >}})  

可用方法有：

``` kotlin
// 课程解析器参数
val params

// 课程解析器参数(强制非空)
fun requireParams()
```

### 注册适配的课程

详见[配置与注册课程导入信息]({{< ref "配置与注册课程导入信息" >}})
