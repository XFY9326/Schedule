---
title: '基于浏览器的课程导入'
---

## 概述

Pure课程表可以通过借助浏览器，让用户在浏览器中指定需要解析的页面  
其优点在于适配简单，而缺点是用户可能会操作繁琐  

注：仅限于课程信息在网页上以文字方式显示的情况  

所用到的课程提供器为：  

* WebCourseProvider

所用到的课程解析器为：  

* WebCourseParser  

关于调试：[WebView网页调试]({{< ref "注意事项#WebView网页调试" >}})

## 适配

在content.adapters的对应文件夹下新建以下类的继承类，并实现具体方法

### WebCourseProvider

必须实现的方法有：

``` kotlin
// 记载初始化页面时调用
// 返回：初始化页面的URL
fun onLoadInitPage(): String

// 判断该页面是否可以被解析时调用
// 参数：当前HTML内容，<iframeContent>中内容，<frameContent>中内容
// 返回：网页信息
fun onValidateCourseImportPage(htmlContent: String, iframeContent: Array<String>, frameContent: Array<String>): WebPageInfo
```

**WebPageInfo**

``` kotlin
// 基于浏览器的课程导入并不会让用户选择导入参数，而是需要通过HTML判断
// 参数：该页面是否可以被解析，导入参数，自定义提供的网页内容
// [自定义提供的网页内容]用于在校验网页是否可以导入后，直接从WebCourseProvider中将需要解析的部分网页传给WebCourseParser，可以不用
class WebPageInfo(val isValidPage: Boolean, val asImportOption: Int = 0, val providedContent: Array<String> = emptyArray())
```

可用方法有：

``` kotlin
// 课程提供器参数
val params

// 课程提供器参数(强制非空)
fun requireParams()
```

### WebCourseParser

必须实现的方法有：

``` kotlin
// 解析课表时间时调用
// 参数：导入参数，网页内容
// 返回：课表时间列表
fun onParseScheduleTimes(importOption: Int, content: WebPageContent): List<ScheduleTime>

// 解析课程时调用
// 参数：导入参数，网页内容
// 返回：课程解析结果
fun onParseCourses(importOption: Int, content: WebPageContent): CourseParseResult
```

相关：  
[CourseParseResult 课程解析结果]({{< ref "课程解析工具方法#CourseParseResult" >}})  
[WebPageContent 网页内容]({{< ref "部分参数的数据结构#网页内容-WebPageContent" >}})  
[课程相关的数据结构]({{< ref "课程相关的数据结构" >}})  

可选实现的方法有：

``` kotlin
// 解析学期时调用
// 参数：导入参数，网页内容
// 返回：Pair<学期开始时间 学期结束时间>
fun onParseScheduleTimes(importOption: Int, content: WebPageContent): Pair<Date, Date>？
```

可用方法有：

``` kotlin
// 课程提供器参数
val params

// 课程提供器参数(强制非空)
fun requireParams()
```

### 注册适配的课程

详见[配置与注册课程导入信息]({{< ref "配置与注册课程导入信息" >}})
