---
title: '课程适配'
---

## 贡献代码

如果想要贡献代码，可以查看[代码贡献指南]({{< ref "代码贡献指南" >}})

## 注意事项

建议在适配课程解析前阅读[注意事项]({{< ref "注意事项" >}})

## 课程导入适配

### 概览

Pure课程表在线课程导入目前主要支持五种方式：

1. [本地模拟登录课程解析]({{< ref "模拟登录与简单网络请求课程导入" >}})
2. [用户通过WebView指定网页课程解析]({{< ref "基于浏览器的课程导入" >}})
3. [基于导入JS的课程解析（支持小爱课程表快速适配）]({{< ref "基于导入JS的课程解析" >}})
4. [外部课程导入（直接将网页信息交给Pure课程表解析）]({{< ref "外部课程导入" >}})
5. [JSON课程导入（直接将已经处理好的课程信息交给Pure课程表导入并展示）]({{< ref "JSON课程导入" >}})
  
课程导入主要分为三个模块：

1. 课程适配器配置（配置使用的课程提供器与解析器，学校与作者名称等）
2. 课程提供器（提供HTML页面给课程解析器解析）
3. 课程解析器（解析HTML页面为实际课程）
4. 外部课程导入处理器（可选）

注意事项：

1. 为保证语言国际化，课程适配器配置以及部分功能需要传入安卓的String资源ID，所有相关字符串定义均应保存在adater_strings.xml与adater_arrays.xml中
2. 请完整的阅读完适配指南后再开始着手适配，先fork项目到个人，调试完成后Pull Request即可（请在develop分支进行修改！）
3. 目前在课程导入中可用的第三方依赖为：

| 依赖名称                                       | 功能                              | 文档                                                                                                        |
| ---------------------------------------------- | --------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| kotlinx-serialization-json                     | JSON与Beans转换                   | [kotlinx.serialization](https://github.com/Kotlin/kotlinx.serialization/blob/master/serialization-guide.md) |
| ktor-client-android, ktor-client-serialization | HTTP网络请求，支持JSON与Beans转换 | [Ktor](https://ktor.io/client.html#client)                                                                  |
| jsoup                                          | HTML解析                          | [Jsoup](https://jsoup.org/cookbook/introduction/parsing-a-document)                                         |

### 主要结构

所有课程导入相关代码均在tool.xfy9326.schedule.content包下  

* adapters：课程导入代码
* adapters.config：配置文件
* adapters.parser：课程提供器
* adapters.processor：外部课程处理器
* adapters.provider：课程解析器
* beans：Beans
* base：抽象类
* utils：工具类

### 部分类功能

* base.AbstractCourseImportConfig：[课程导入配置基类]({{< ref "配置与注册课程导入信息#AbstractCourseImportConfig" >}})
* base.AbstractExternalCourseProcessor：[外部课程导入处理器基类]({{< ref "外部课程导入#AbstractExternalCourseProcessor" >}})
* base.LoginCourseProvider：[模拟登录课程提供器]({{< ref "模拟登录与简单网络请求课程导入#NetworkCourseParserLoginCourseProvider" >}})
* base.NetworkCourseParser：[基础网络课程解析器]({{< ref "模拟登录与简单网络请求课程导入#NetworkCourseParser" >}})
* base.NetworkCourseProvider：[基础网络课程提供器]({{< ref "模拟登录与简单网络请求课程导入#NetworkCourseProviderLoginCourseProvider" >}})
* base.WebCourseParser：[网页分析课程解析器]({{< ref "基于浏览器的课程导入#WebCourseParser" >}})
* base.WebCourseProvider：[网页分析课程提供器]({{< ref "基于浏览器的课程导入#WebCourseProvider" >}})
* utils.CourseAdapterException：[课程适配器错误]({{< ref "错误处理" >}})
* utils.CourseAdapterTools：[课程适配器Kotlin工具类]({{< ref "课程解析工具方法#CourseAdapterTools" >}})
* utils.CourseAdapterUtils：[课程适配器静态工具类]({{< ref "课程解析工具方法#CourseAdapterUtils" >}})
* utils.CourseParseResult：[课程导入结果]({{< ref "课程解析工具方法#CourseParseResult" >}})

### 简要适配步骤

#### 本地课程导入

1. 继承[NetworkCourseProvider/LoginCourseProvider]({{< ref "模拟登录与简单网络请求课程导入#NetworkCourseParserLoginCourseProvider" >}})/[WebCourseProvider]({{< ref "基于浏览器的课程导入#WebCourseProvider" >}})，编写课程提供器
2. 继承[NetworkCourseParser]({{< ref "模拟登录与简单网络请求课程导入#NetworkCourseParser" >}})/[WebCourseParser]({{< ref "基于浏览器的课程导入#WebCourseParser" >}})，编写课程解析器
3. 继承[AbstractCourseImportConfig]({{< ref "配置与注册课程导入信息#AbstractCourseImportConfig" >}})，编写课程导入配置，指定要使用的课程提供器与解析器

#### JS课程导入

详见[基于导入JS的课程解析]({{< ref "基于导入JS的课程解析" >}})  

#### 外部课程导入接口

详见[外部课程导入]({{< ref "外部课程导入" >}})  

------  
注1：实际使用时，如果已经有人写好某教务系统的提供器或者解析器，可以跳过1，2两步  
**注2：建议在适配前查看并使用[课程解析工具方法]({{< ref "课程解析工具方法" >}})，合理的使用可以提高适配效率**

具体适配方法请参阅不同适配器详细的适配方法
